<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ir_slcls_loan_top30" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="7bea3e94-493b-4a2a-8893-5540350c55ce">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="as_coopid" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="as_period" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select
$P{as_period} as period ,
substr($P{as_period} ,1,4) as year,
(case
             when  trim(substr($P{as_period},5,6))= '01'  then 'มกราคม'
             when  trim(substr($P{as_period},5,6))= '02'  then 'กุมภาพันธ์'
            when  trim(substr($P{as_period},5,6))= '03'  then 'มีนาคม'
            when  trim(substr($P{as_period},5,6)) = '04' then 'เมษายน'
            when  trim(substr($P{as_period},5,6))= '05'  then 'พฤษภาคม'
            when  trim(substr($P{as_period},5,6))= '06'  then 'มิถุนายน'
            when  trim(substr($P{as_period},5,6))= '07'  then 'กรกฎาคม'
            when  trim(substr($P{as_period},5,6))= '08'  then 'สิงหาคม'
            when  trim(substr($P{as_period},5,6))= '09'  then 'กันยายน'
            when  trim(substr($P{as_period},5,6))= '10' then 'ตุลาคม'
            when  trim(substr($P{as_period},5,6))= '11'  then 'พฤศจิกายน'
		   when  trim(substr($P{as_period},5,6))= '12'  then 'ธันวาคม'
            else ' '
        END) as Months ,
master.member_no ,
master.loanapprove_amt ,
master.balance_value ,
ft_getmbname(mbmembmaster.coop_id, master.member_no ) as fullanme ,
mbmembmaster.card_person
from
( select slclsmthbalance.member_no , sum( lncontmaster.loanapprove_amt ) as loanapprove_amt , sum( slclsmthbalance.balance_value ) as balance_value , rank()over(order by sum( lncontmaster.loanapprove_amt ) desc , slclsmthbalance.member_no ) as rank
from slclsmthbalance
left join lncontmaster on slclsmthbalance.loancontract_no = lncontmaster.loancontract_no
where slclsmthbalance.clsmth_period = $P{as_period}
and slclsmthbalance.bizz_system = 'LON'
group by slclsmthbalance.member_no ) master
left join mbmembmaster on master.member_no = mbmembmaster.member_no
where rank <= 30
order by rank ,master.member_no]]>
	</queryString>
	<field name="PERIOD" class="java.lang.String"/>
	<field name="YEAR" class="java.lang.String"/>
	<field name="MONTHS" class="java.lang.String"/>
	<field name="MEMBER_NO" class="java.lang.String"/>
	<field name="LOANAPPROVE_AMT" class="java.math.BigDecimal"/>
	<field name="BALANCE_VALUE" class="java.math.BigDecimal"/>
	<field name="FULLANME" class="java.lang.String"/>
	<field name="CARD_PERSON" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="44" splitType="Stretch">
			<staticText>
				<reportElement uuid="c93e6d1b-f9eb-48ff-b1b9-5f317794f35c" x="0" y="0" width="555" height="24"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="16"/>
				</textElement>
				<text><![CDATA[รายงานสมาชิกที่มีหนี้ 30 อันดับแรก]]></text>
			</staticText>
			<textField>
				<reportElement uuid="69e97c13-f833-4fd1-867f-683286533d17" x="0" y="24" width="555" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="16"/>
				</textElement>
				<textFieldExpression><![CDATA["ประจำเดือน " + $F{MONTHS} + " พ.ศ. " + $F{YEAR}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="58" splitType="Stretch">
			<staticText>
				<reportElement uuid="9b21927c-a66c-46e8-93e7-fbc4198b6ec4" x="475" y="0" width="80" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ยอดคงเหลือรวม]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="f36878e7-f944-4d10-a753-d57fa3bbe76e" x="362" y="0" width="113" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ยอดขอกู้รวม]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="db386d77-8954-476d-9db0-8192b2a4f6f7" x="295" y="0" width="67" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[บัตรประชาชน]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="002cb945-dd84-41d4-aaae-f8539e2d9c34" x="89" y="0" width="206" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ชื่อ - นามสกุล]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="d0786a63-3788-402f-978d-8b594433b933" x="24" y="0" width="65" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[เลขสมาชิก]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="f834e588-808e-48d6-acc1-27996792163c" x="0" y="0" width="24" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ลำดับ]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="7d9c1c9f-71b9-466d-9fa3-e29838abcb1f" x="231" y="20" width="64" height="38"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[เลขสัญญา]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="e99b0ef0-e0a8-4867-9a89-6856e0384232" x="295" y="20" width="67" height="38"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[วันที่เริ่มสัญญา]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="8c470355-cbac-4a35-ab15-10a703172771" x="361" y="20" width="34" height="38"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[อัตรา ดอกเบี้ย]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="9e574957-30b5-4325-a0d1-6fd8b4d45a25" x="395" y="20" width="80" height="38"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ยอดขอกู้]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="f7ff0182-3ba5-4095-b402-55e0cf5585e0" x="475" y="20" width="80" height="38"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ยอดคงเหลือ]]></text>
			</staticText>
		</band>
	</pageHeader>
	<detail>
		<band height="44" splitType="Prevent">
			<textField>
				<reportElement uuid="65669057-3293-4cb4-9740-4aa5e737cf0f" x="24" y="0" width="65" height="20"/>
				<textElement>
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MEMBER_NO}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="055e4e42-9be8-4594-b6a2-761369b7f723" x="89" y="0" width="206" height="20"/>
				<textElement>
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{FULLANME}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="0334bf45-6b9f-4d4c-b0db-0195d871c795" x="295" y="0" width="66" height="20"/>
				<textElement>
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{CARD_PERSON}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="b5a7cff8-542e-4f6f-993f-6381e38e8c7c" x="361" y="0" width="114" height="20"/>
				<textElement textAlignment="Right">
					<font fontName="Angsana New" size="14" isBold="true" isUnderline="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{LOANAPPROVE_AMT}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="f03e64c0-ff73-423f-9b6c-5e28d1db8211" x="475" y="0" width="80" height="20"/>
				<textElement textAlignment="Right">
					<font fontName="Angsana New" size="14" isBold="true" isUnderline="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{BALANCE_VALUE}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="1df82625-20a1-4cac-9bf9-34fb1b79ebd8" x="0" y="0" width="24" height="20"/>
				<textElement>
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
			<subreport>
				<reportElement uuid="aa6a57fa-9490-42fd-ba4c-d54b3f6511a9" x="231" y="20" width="324" height="23"/>
				<subreportParameter name="recv_period">
					<subreportParameterExpression><![CDATA[$P{as_period}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="as_coopid">
					<subreportParameterExpression><![CDATA[$P{as_coopid}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="as_membno">
					<subreportParameterExpression><![CDATA[$F{MEMBER_NO}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[ "ir_slcls_loan_top30_nest.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</detail>
</jasperReport>
